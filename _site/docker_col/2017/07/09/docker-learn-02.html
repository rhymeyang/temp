


    



<!-- Include Data Base --> <!DOCTYPE html> <html lang="en" itemscope itemtype="http://schema.org/WebPage"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Docker系列 2 架构详解 | Vicky's Blog </title> <meta name=description content=""> <meta name="robots" content="index, follow"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta http-equiv="cache-control" content="public"/> <meta http-equiv="pragma" content="public"> <meta name="keywords" content="Theme, Jekyll" /> <meta name="author" content="" /> <meta property="og:locale" content="en" /> <meta property="og:site_name" content="Vicky's Blog" /> <meta property="og:type" content="WebSite" /> <meta property="og:url" content="http://www.forbackup.tk/docker_col/2017/07/09/docker-learn-02.html" /> <meta property="og:description" content="" /> <meta property="og:title" content="Docker系列 2 架构详解 - Vicky's Blog" /> <link rel="canonical" href="http://www.forbackup.tk/docker_col/2017/07/09/docker-learn-02.html"> <link rel="alternate" type="application/rss+xml" title="Vicky's Blog" href="http://www.forbackup.tk/feed.xml"> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "WebSite", "name": "", "headline": "Vicky's Blog", "author": {"@type": "Person", "name": {"Vicky's Blog"}}, "description": "", "url": "http://www.forbackup.tk"} </script> <script type="text/javascript"> var GLOBAL_BASEURL = "http://www.forbackup.tk"; </script> <link rel="icon" type="image/png" sizes="16x16" href="http://www.forbackup.tk/assets/img/favicon/favicon-16x16.png"> <!-- #### VENDOR OFFLINE #### --> <!-- Bootstrap 3.3.6 - Offline --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/bootstrap/css/bootstrap.min.css"> <!-- Font Awesome 5.03 - Offline --> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css"></script> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/space-mono/space-mono.min.css"> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/gloria-hallelujah/gloria-hallelujah.min.css"> <!-- Style Default --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/stylesheets/main.css"> <!-- Google Analytics --> </head> <body> <div class="main" id="top"> <div class="container wrapper"> <div class="row"> <div class="col-sm-3 sidebar"> <div class="row avatar"> <a href="http://www.forbackup.tk/"> <img class="img-responsive center-block avatar-img" src="http://www.forbackup.tk/assets/img/avatar/blog.svg" height="165" width="165" alt="Vicky's Blog"> </a> </div> <div class="row header"> <h2><a href="http://www.forbackup.tk/">Vicky </a></h2> </div> <div class="row menu"> <ul> <li> <i class="fa fa-home" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/">Home</a> </li> <hr class="breakline"> <li class="li-folder-open"> <i style="font-size: ;" class="fas fa-folder-open"></i>&nbsp;<a class="unlink">Blog</a> </li> <li class="li-fa-edit"> <i style="font-size: ;" class="fas fa-edit" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/general/" >General</a> </li> <li class="li-fa-docker"> <i style="font-size: ;" class="fab fa-docker" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/docker_col/" >Docker</a> </li> <li class="li-fa-table"> <i style="font-size: ;" class="fas fa-table" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/data_analysis/" >Data Analysis</a> </li> <li class="li-fa-tags"> <i style="font-size: ;" class="fas fa-tags" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/tags/" >Tags</a> </li> <li class="li-fa-briefcase"> <i style="font-size: ;" class="fas fa-briefcase" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/projects/" >Projects</a> </li> </ul> <div class="socials"> <div class="row"> <p></p> <p></p> </div> </div> </div> </div> <div class="col-sm-9 content-main"> <!-- Include Data Base --> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <!-- Next Version <div class="readmode"> <a id="btn-readmode" class="pull-right btn btn-default btn-readmode" href="">Read Mode</a> </div> --> <div class="row title"> <h1>Docker系列 2 架构详解</h1> </div> <div class="row meta" datetime="2017-07-09"> <time class="col-sm-6 datetime"> <i class="fa fa-calendar" aria-hidden="true"></i> <span class="text tmargin ">July 09, 2017</span> </time> </div> <div class="row tag-list"> <i class="fa fa-tags" aria-hidden="true"></i> <a href="http://www.forbackup.tk/blog/tags//linux">linux</a> <a href="http://www.forbackup.tk/blog/tags//docker">docker</a> </div> <!-- <div class="row"> <ul id="markdown-toc"> <li><a href="#docker-客户端" id="markdown-toc-docker-客户端">Docker 客户端</a></li> <li><a href="#docker-服务器" id="markdown-toc-docker-服务器">Docker 服务器</a></li> <li><a href="#docker-镜像" id="markdown-toc-docker-镜像">Docker 镜像</a></li> <li><a href="#docker-容器" id="markdown-toc-docker-容器">Docker 容器</a></li> <li><a href="#registry" id="markdown-toc-registry">Registry</a></li> </ul> <p>Docker 的核心组件包括：</p> <ol> <li>Docker 客户端 - Client</li> <li>Docker 服务器 - Docker daemon</li> <li>Docker 镜像 - Image</li> <li>Registry</li> <li>Docker 容器 - Container</li> </ol> <p>Docker 架构如下图所示：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_framework.jpg" alt="Docker 架构 @x100" /></p> <p>Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。</p> <h2 id="docker-客户端">Docker 客户端</h2> <p>最常用的 Docker 客户端是 <code class="highlighter-rouge">docker 命令</code>。通过 docker 我们可以方便地在 Host 上构建和运行容器。</p> <p><code class="highlighter-rouge">docker</code> 支持很多操作（子命令）</p> <p>除了 <code class="highlighter-rouge">docker</code> 命令行工具，用户也可以通过 REST API 与服务器通信。</p> <h2 id="docker-服务器">Docker 服务器</h2> <p>Docker daemon 是服务器组件，以 Linux 后台服务的方式运行。</p> <p>Docker daemon 运行在 Docker host 上，负责创建、运行、监控容器，构建、存储镜像。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nt">--version</span>
Docker version 17.03.2-ce, build f5ec1e2</code></pre></figure> <p>默认配置下，Docker daemon 只能响应来自本地 Host 的客户端请求。如果要允许远程客户端请求，需要在配置文件中打开 TCP 监听，步骤如下：</p> <ol> <li>编辑配置文件 <code class="highlighter-rouge">/etc/systemd/system/multi-user.target.wants/docker.service</code> <ul> <li>在环境变量 <code class="highlighter-rouge">ExecStart</code> 后面添加 <code class="highlighter-rouge">-H tcp://0.0.0.0</code>，允许来自任意 IP 的客户端连接。</li> <li>-H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock</li> <li>-H fd:// will make docker unable start</li> </ul> </li> <li>重启 Docker daemon <ul> <li><code class="highlighter-rouge">systemctl daemon-reload</code></li> </ul> </li> <li>服务器 IP 为 192.168.1.108，客户端在命令行里加上 -H 参数，即可与远程服务器通信。 <ul> <li><code class="highlighter-rouge">docker 192.168.1.108</code></li> </ul> </li> </ol> <h2 id="docker-镜像">Docker 镜像</h2> <p>可将 Docker 镜像看着只读模板，通过它可以创建 Docker 容器。</p> <p>例如某个镜像可能包含一个 Ubuntu 操作系统、一个 Apache HTTP Server 以及用户开发的 Web 应用。</p> <p>镜像有多种生成方法：</p> <ul> <li>可以从无到有开始创建镜像</li> <li>也可以下载并使用别人创建好的现成的镜像</li> <li>还可以在现有镜像上创建新的镜像</li> </ul> <p>我们可以将镜像的内容和创建步骤描述在一个文本文件中，这个文件被称作 Dockerfile，通过执行 docker build <docker-file> 命令可以构建出 Docker 镜像，后面我们会讨论。</docker-file></p> <h2 id="docker-容器">Docker 容器</h2> <p>Docker 容器就是 Docker 镜像的运行实例。</p> <p>用户可以通过 CLI（docker）或是 API 启动、停止、移动或删除容器。可以这么认为，对于应用软件，镜像是软件生命周期的构建和打包阶段，而容器则是启动和运行阶段。</p> <h2 id="registry">Registry</h2> <p>Registry 是存放 Docker 镜像的仓库，Registry 分私有和公有两种。</p> <p><a href="https://hub.docker.com/">Docker Hub</a> 是默认的 Registry，由 Docker 公司维护，上面有数以万计的镜像，用户可以自由下载和使用。</p> <p>出于对速度或安全的考虑，用户也可以创建自己的私有 Registry。后面我们会学习如何搭建私有 Registry。</p> <ul> <li><code class="highlighter-rouge">docker pull</code> 命令可以从 Registry 下载镜像。</li> <li><code class="highlighter-rouge">docker run</code> 命令则是先下载镜像（如果本地没有），然后再启动容器。</li> </ul> 1677 </div> --> <div class="row content"> <ul id="markdown-toc"> <li><a href="#docker-客户端" id="markdown-toc-docker-客户端">Docker 客户端</a></li> <li><a href="#docker-服务器" id="markdown-toc-docker-服务器">Docker 服务器</a></li> <li><a href="#docker-镜像" id="markdown-toc-docker-镜像">Docker 镜像</a></li> <li><a href="#docker-容器" id="markdown-toc-docker-容器">Docker 容器</a></li> <li><a href="#registry" id="markdown-toc-registry">Registry</a></li> </ul> <p>Docker 的核心组件包括：</p> <ol> <li>Docker 客户端 - Client</li> <li>Docker 服务器 - Docker daemon</li> <li>Docker 镜像 - Image</li> <li>Registry</li> <li>Docker 容器 - Container</li> </ol> <p>Docker 架构如下图所示：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_framework.jpg" alt="Docker 架构 @x100" /></p> <p>Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。</p> <h2 id="docker-客户端">Docker 客户端</h2> <p>最常用的 Docker 客户端是 <code class="highlighter-rouge">docker 命令</code>。通过 docker 我们可以方便地在 Host 上构建和运行容器。</p> <p><code class="highlighter-rouge">docker</code> 支持很多操作（子命令）</p> <p>除了 <code class="highlighter-rouge">docker</code> 命令行工具，用户也可以通过 REST API 与服务器通信。</p> <h2 id="docker-服务器">Docker 服务器</h2> <p>Docker daemon 是服务器组件，以 Linux 后台服务的方式运行。</p> <p>Docker daemon 运行在 Docker host 上，负责创建、运行、监控容器，构建、存储镜像。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nt">--version</span>
Docker version 17.03.2-ce, build f5ec1e2</code></pre></figure> <p>默认配置下，Docker daemon 只能响应来自本地 Host 的客户端请求。如果要允许远程客户端请求，需要在配置文件中打开 TCP 监听，步骤如下：</p> <ol> <li>编辑配置文件 <code class="highlighter-rouge">/etc/systemd/system/multi-user.target.wants/docker.service</code> <ul> <li>在环境变量 <code class="highlighter-rouge">ExecStart</code> 后面添加 <code class="highlighter-rouge">-H tcp://0.0.0.0</code>，允许来自任意 IP 的客户端连接。</li> <li>-H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock</li> <li>-H fd:// will make docker unable start</li> </ul> </li> <li>重启 Docker daemon <ul> <li><code class="highlighter-rouge">systemctl daemon-reload</code></li> </ul> </li> <li>服务器 IP 为 192.168.1.108，客户端在命令行里加上 -H 参数，即可与远程服务器通信。 <ul> <li><code class="highlighter-rouge">docker 192.168.1.108</code></li> </ul> </li> </ol> <h2 id="docker-镜像">Docker 镜像</h2> <p>可将 Docker 镜像看着只读模板，通过它可以创建 Docker 容器。</p> <p>例如某个镜像可能包含一个 Ubuntu 操作系统、一个 Apache HTTP Server 以及用户开发的 Web 应用。</p> <p>镜像有多种生成方法：</p> <ul> <li>可以从无到有开始创建镜像</li> <li>也可以下载并使用别人创建好的现成的镜像</li> <li>还可以在现有镜像上创建新的镜像</li> </ul> <p>我们可以将镜像的内容和创建步骤描述在一个文本文件中，这个文件被称作 Dockerfile，通过执行 docker build <docker-file> 命令可以构建出 Docker 镜像，后面我们会讨论。</docker-file></p> <h2 id="docker-容器">Docker 容器</h2> <p>Docker 容器就是 Docker 镜像的运行实例。</p> <p>用户可以通过 CLI（docker）或是 API 启动、停止、移动或删除容器。可以这么认为，对于应用软件，镜像是软件生命周期的构建和打包阶段，而容器则是启动和运行阶段。</p> <h2 id="registry">Registry</h2> <p>Registry 是存放 Docker 镜像的仓库，Registry 分私有和公有两种。</p> <p><a href="https://hub.docker.com/">Docker Hub</a> 是默认的 Registry，由 Docker 公司维护，上面有数以万计的镜像，用户可以自由下载和使用。</p> <p>出于对速度或安全的考虑，用户也可以创建自己的私有 Registry。后面我们会学习如何搭建私有 Registry。</p> <ul> <li><code class="highlighter-rouge">docker pull</code> 命令可以从 Registry 下载镜像。</li> <li><code class="highlighter-rouge">docker run</code> 命令则是先下载镜像（如果本地没有），然后再启动容器。</li> </ul> <div class="col-sm-2 image pull-right"> <img class="avatar-img avata" style='border="0";border-radius: 50%' src="http://www.forbackup.tk/assets/img/author/blog.svg" alt="" height="32px" width="32px"> </div> </div> <ul class="pager"> <li><a href="/docker_col/2017/07/09/docker-learn-01.html">Docker系列 1 安装</a></li> <li><a href="/docker_col/2017/07/09/docker-learn-03.html">Docker系列 3 组件协作</a></li> </ul> </article> </div> </div> </div> <div class="footer"> <div class="container-fluid"> <div class="row-fluid"> <div class="col-sm-4 copyright"> <span>Vicky's Blog © 2018 • All right reserved.</span> </div> <div class="col-sm-4 message"> <span>Simplicity is fashionable.</span> </div> <div class="col-sm-4 madeby"> <span>Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;by&nbsp;Vicky.</span> </div> <a class="pull-right top" href="#top"><i class="fa fa-caret-up" aria-hidden="true"></i></a> </div> </div> </div> </div> <!-- Vendor - Global | Applicable to every website --> <!-- #### VENDOR OFFLINE #### --> <script src="http://www.forbackup.tk/assets/vendor-off/jquery/js/jquery.min.js"></script> <script src="http://www.forbackup.tk/assets/vendor-off/bootstrap/js/bootstrap.min.js"></script> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/svg-with-js/js/fontawesome-all.min.js"></script> <script src="http://www.forbackup.tk/assets/javascripts/jekyll-spotify-plugin.min.js"></script> <!-- Specific for each pages. --> <script type="text/javascript" src="http://www.forbackup.tk/assets/javascripts/post.js"></script> <!-- Add 'ga' function from Google Analytics to certain site links in Posts --> <!-- App | Global --> <script src="http://www.forbackup.tk/assets/javascripts/global.js"></script> </body> </html>




    



<!-- Include Data Base --> <!DOCTYPE html> <html lang="en" itemscope itemtype="http://schema.org/WebPage"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Docker系列 6 镜像命名的最佳实践 | Vicky's Blog </title> <meta name=description content=""> <meta name="robots" content="index, follow"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta http-equiv="cache-control" content="public"/> <meta http-equiv="pragma" content="public"> <meta name="keywords" content="Theme, Jekyll" /> <meta name="author" content="" /> <meta property="og:locale" content="en" /> <meta property="og:site_name" content="Vicky's Blog" /> <meta property="og:type" content="WebSite" /> <meta property="og:url" content="http://www.forbackup.tk/docker_col/2017/07/30/docker-learn-06.html" /> <meta property="og:description" content="" /> <meta property="og:title" content="Docker系列 6 镜像命名的最佳实践 - Vicky's Blog" /> <link rel="canonical" href="http://www.forbackup.tk/docker_col/2017/07/30/docker-learn-06.html"> <link rel="alternate" type="application/rss+xml" title="Vicky's Blog" href="http://www.forbackup.tk/feed.xml"> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "WebSite", "name": "", "headline": "Vicky's Blog", "author": {"@type": "Person", "name": {"Vicky's Blog"}}, "description": "", "url": "http://www.forbackup.tk"} </script> <script type="text/javascript"> var GLOBAL_BASEURL = "http://www.forbackup.tk"; </script> <link rel="icon" type="image/png" sizes="16x16" href="http://www.forbackup.tk/assets/img/favicon/favicon-16x16.png"> <!-- #### VENDOR OFFLINE #### --> <!-- Bootstrap 3.3.6 - Offline --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/bootstrap/css/bootstrap.min.css"> <!-- Font Awesome 5.03 - Offline --> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css"></script> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/space-mono/space-mono.min.css"> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/gloria-hallelujah/gloria-hallelujah.min.css"> <!-- Style Default --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/stylesheets/main.css"> <!-- Google Analytics --> </head> <body> <div class="main" id="top"> <div class="container wrapper"> <div class="row"> <div class="col-sm-3 sidebar"> <div class="row avatar"> <a href="http://www.forbackup.tk/"> <img class="img-responsive center-block avatar-img" src="http://www.forbackup.tk/assets/img/avatar/blog.svg" height="165" width="165" alt="Vicky's Blog"> </a> </div> <div class="row header"> <h2><a href="http://www.forbackup.tk/">Vicky </a></h2> </div> <div class="row menu"> <ul> <li> <i class="fa fa-home" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/">Home</a> </li> <hr class="breakline"> <li class="li-folder-open"> <i style="font-size: ;" class="fas fa-folder-open"></i>&nbsp;<a class="unlink">Blog</a> </li> <li class="li-fa-edit"> <i style="font-size: ;" class="fas fa-edit" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/general/" >General</a> </li> <li class="li-fa-docker"> <i style="font-size: ;" class="fab fa-docker" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/docker_col/" >Docker</a> </li> <li class="li-fa-table"> <i style="font-size: ;" class="fas fa-table" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/data_analysis/" >Data Analysis</a> </li> <li class="li-fa-tags"> <i style="font-size: ;" class="fas fa-tags" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/tags/" >Tags</a> </li> <li class="li-fa-briefcase"> <i style="font-size: ;" class="fas fa-briefcase" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/projects/" >Projects</a> </li> </ul> <div class="socials"> <div class="row"> <p></p> <p></p> </div> </div> </div> </div> <div class="col-sm-9 content-main"> <!-- Include Data Base --> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <!-- Next Version <div class="readmode"> <a id="btn-readmode" class="pull-right btn btn-default btn-readmode" href="">Read Mode</a> </div> --> <div class="row title"> <h1>Docker系列 6 镜像命名的最佳实践</h1> </div> <div class="row meta" datetime="2017-07-30"> <time class="col-sm-6 datetime"> <i class="fa fa-calendar" aria-hidden="true"></i> <span class="text tmargin ">July 30, 2017</span> </time> </div> <div class="row tag-list"> <i class="fa fa-tags" aria-hidden="true"></i> <a href="http://www.forbackup.tk/blog/tags//linux">linux</a> <a href="http://www.forbackup.tk/blog/tags//docker">docker</a> </div> <!-- <div class="row"> <ul id="markdown-toc"> <li><a href="#为镜像命名" id="markdown-toc-为镜像命名">为镜像命名</a></li> <li><a href="#tag-使用最佳实践" id="markdown-toc-tag-使用最佳实践">tag 使用最佳实践</a></li> </ul> <p>我们已经学会构建自己的镜像了。接下来的问题是如何在多个 Docker Host 上使用镜像。</p> <p>这里有几种可用的方法：</p> <ul> <li>用相同的 Dockerfile 在其他 host 构建镜像。</li> <li>将镜像上传到公共 Registry（比如 Docker Hub），Host 直接下载使用。</li> <li>搭建私有的 Registry 供本地 Host 使用。</li> </ul> <p>第一种方法没什么特别的，前面已经讨论很多了。我们将讨论如何使用公共和私有 Registry 分发镜像。</p> <h3 id="为镜像命名">为镜像命名</h3> <p>无论采用何种方式保存和分发镜像，首先都得给镜像命名。</p> <p>当我们执行 <code class="highlighter-rouge">docker build</code> 命令时已经为镜像取了个名字，例如前面：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker build <span class="nt">-t</span> ubuntu-with-vi</code></pre></figure> <p>这里的 <code class="highlighter-rouge">ubuntu-with-vi</code> 就是镜像的名字。通过 dock images 可以查看镜像的信息。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_name.jpg" alt="Docker image @x100" /></p> <p>这里注意到 <code class="highlighter-rouge">ubuntu-with-vi</code> 对应的是 <code class="highlighter-rouge">REPOSITORY</code>，而且还有一个叫 <code class="highlighter-rouge">latest</code> 的 <code class="highlighter-rouge">TAG</code>。</p> <p>实际上一个特定镜像的名字由两部分组成：repository 和 tag。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[image name] = [repository]:[tag]
</code></pre></div></div> <p>如果执行 docker build 时没有指定 tag，会使用默认值 latest。其效果相当于：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker build <span class="nt">-t</span> ubuntu-with-vi:latest</code></pre></figure> <p><code class="highlighter-rouge">tag</code> 常用于描述镜像的版本信息，比如 httpd 镜像：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/http_info.jpg" alt="httpd @x100" /></p> <p>当然 <code class="highlighter-rouge">tag</code> 可以是任意字符串，比如 ubuntu 镜像：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/ubuntu_info.jpg" alt="ubuntu info @x100" /></p> <blockquote> <p><strong>小心 latest tag</strong></p> <p>千万别被 latest tag 给误导了。latest 其实并没有什么特殊的含义。当没指明镜像 tag 时，Docker 会使用默认值 latest，仅此而已。</p> </blockquote> <p>虽然 Docker Hub 上很多 repository 将 latest 作为最新稳定版本的别名，但这只是一种约定，而不是强制规定。</p> <p>所以我们在使用镜像时最好还是避免使用 latest，明确指定某个 tag，比如 httpd:2.3，ubuntu:xenial。</p> <h3 id="tag-使用最佳实践">tag 使用最佳实践</h3> <p>借鉴软件版本命名方式能够让用户很好地使用镜像。</p> <p>一个高效的版本命名方案可以让用户清楚地知道当前使用的是哪个镜像，同时还可以保持足够的灵活性。</p> <p>每个 repository 可以有多个 tag，而多个 tag 可能对应的是同一个镜像。下面通过例子为大家介绍 Docker 社区普遍使用的 tag 方案。</p> <p>假设我们现在发布了一个镜像 myimage，版本为 v1.9.1。那么我们可以给镜像打上四个 tag：1.9.1、1.9、1 和 latest。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/image_1.9.1.jpg" alt="tag 1.9.1 @x100" /></p> <p>我们可以通过 docker tag 命令方便地给镜像打 tag。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v1.9.1 myimage:1

docker tag myimage-v1.9.1 myimage:1.9

docker tag myimage-v1.9.1 myimage:1.9.1

docker tag myimage-v1.9.1 myimage:latest</code></pre></figure> <p><br /> 过了一段时间，我们发布了 v1.9.2。这时可以打上 1.9.2 的 tag，并将 1.9、1 和 latest 从 v1.9.1 移到 v1.9.2。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/image_1.9.2.jpg" alt="tag 1.9.2 @x100" /></p> <p>命令为：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v1.9.2 myimage:1

docker tag myimage-v1.9.2 myimage:1.9

docker tag myimage-v1.9.2 myimage:1.9.2

docker tag myimage-v1.9.2 myimage:latest</code></pre></figure> <p>之后，v2.0.0 发布了。这时可以打上 2.0.0、2.0 和 2 的 tag，并将 latest 移到 v2.0.0。</p> <p>命令为：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v2.0.0 myimage:2

docker tag myimage-v2.0.0 myimage:2.0

docker tag myimage-v2.0.0 myimage:2.0.0

docker tag myimage-v2.0.0 myimage:latest</code></pre></figure> <p>这种 tag 方案使镜像的版本很直观，用户在选择非常灵活：</p> <ul> <li>myimage:1 始终指向 1 这个分支中最新的镜像。</li> <li>myimage:1.9 始终指向 1.9.x 中最新的镜像。</li> <li>myimage:latest 始终指向所有版本中最新的镜像。</li> </ul> <p>如果想使用特定版本，可以选择 myimage:1.9.1、myimage:1.9.2 或 myimage:2.0.0。</p> <p>Docker Hub 上很多 repository 都采用这种方案，所以大家一定要熟悉。</p> 1970 </div> --> <div class="row content"> <ul id="markdown-toc"> <li><a href="#为镜像命名" id="markdown-toc-为镜像命名">为镜像命名</a></li> <li><a href="#tag-使用最佳实践" id="markdown-toc-tag-使用最佳实践">tag 使用最佳实践</a></li> </ul> <p>我们已经学会构建自己的镜像了。接下来的问题是如何在多个 Docker Host 上使用镜像。</p> <p>这里有几种可用的方法：</p> <ul> <li>用相同的 Dockerfile 在其他 host 构建镜像。</li> <li>将镜像上传到公共 Registry（比如 Docker Hub），Host 直接下载使用。</li> <li>搭建私有的 Registry 供本地 Host 使用。</li> </ul> <p>第一种方法没什么特别的，前面已经讨论很多了。我们将讨论如何使用公共和私有 Registry 分发镜像。</p> <h3 id="为镜像命名">为镜像命名</h3> <p>无论采用何种方式保存和分发镜像，首先都得给镜像命名。</p> <p>当我们执行 <code class="highlighter-rouge">docker build</code> 命令时已经为镜像取了个名字，例如前面：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker build <span class="nt">-t</span> ubuntu-with-vi</code></pre></figure> <p>这里的 <code class="highlighter-rouge">ubuntu-with-vi</code> 就是镜像的名字。通过 dock images 可以查看镜像的信息。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_name.jpg" alt="Docker image @x100" /></p> <p>这里注意到 <code class="highlighter-rouge">ubuntu-with-vi</code> 对应的是 <code class="highlighter-rouge">REPOSITORY</code>，而且还有一个叫 <code class="highlighter-rouge">latest</code> 的 <code class="highlighter-rouge">TAG</code>。</p> <p>实际上一个特定镜像的名字由两部分组成：repository 和 tag。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[image name] = [repository]:[tag]
</code></pre></div></div> <p>如果执行 docker build 时没有指定 tag，会使用默认值 latest。其效果相当于：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker build <span class="nt">-t</span> ubuntu-with-vi:latest</code></pre></figure> <p><code class="highlighter-rouge">tag</code> 常用于描述镜像的版本信息，比如 httpd 镜像：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/http_info.jpg" alt="httpd @x100" /></p> <p>当然 <code class="highlighter-rouge">tag</code> 可以是任意字符串，比如 ubuntu 镜像：</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/ubuntu_info.jpg" alt="ubuntu info @x100" /></p> <blockquote> <p><strong>小心 latest tag</strong></p> <p>千万别被 latest tag 给误导了。latest 其实并没有什么特殊的含义。当没指明镜像 tag 时，Docker 会使用默认值 latest，仅此而已。</p> </blockquote> <p>虽然 Docker Hub 上很多 repository 将 latest 作为最新稳定版本的别名，但这只是一种约定，而不是强制规定。</p> <p>所以我们在使用镜像时最好还是避免使用 latest，明确指定某个 tag，比如 httpd:2.3，ubuntu:xenial。</p> <h3 id="tag-使用最佳实践">tag 使用最佳实践</h3> <p>借鉴软件版本命名方式能够让用户很好地使用镜像。</p> <p>一个高效的版本命名方案可以让用户清楚地知道当前使用的是哪个镜像，同时还可以保持足够的灵活性。</p> <p>每个 repository 可以有多个 tag，而多个 tag 可能对应的是同一个镜像。下面通过例子为大家介绍 Docker 社区普遍使用的 tag 方案。</p> <p>假设我们现在发布了一个镜像 myimage，版本为 v1.9.1。那么我们可以给镜像打上四个 tag：1.9.1、1.9、1 和 latest。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/image_1.9.1.jpg" alt="tag 1.9.1 @x100" /></p> <p>我们可以通过 docker tag 命令方便地给镜像打 tag。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v1.9.1 myimage:1

docker tag myimage-v1.9.1 myimage:1.9

docker tag myimage-v1.9.1 myimage:1.9.1

docker tag myimage-v1.9.1 myimage:latest</code></pre></figure> <p><br /> 过了一段时间，我们发布了 v1.9.2。这时可以打上 1.9.2 的 tag，并将 1.9、1 和 latest 从 v1.9.1 移到 v1.9.2。</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/image_1.9.2.jpg" alt="tag 1.9.2 @x100" /></p> <p>命令为：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v1.9.2 myimage:1

docker tag myimage-v1.9.2 myimage:1.9

docker tag myimage-v1.9.2 myimage:1.9.2

docker tag myimage-v1.9.2 myimage:latest</code></pre></figure> <p>之后，v2.0.0 发布了。这时可以打上 2.0.0、2.0 和 2 的 tag，并将 latest 移到 v2.0.0。</p> <p>命令为：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker tag myimage-v2.0.0 myimage:2

docker tag myimage-v2.0.0 myimage:2.0

docker tag myimage-v2.0.0 myimage:2.0.0

docker tag myimage-v2.0.0 myimage:latest</code></pre></figure> <p>这种 tag 方案使镜像的版本很直观，用户在选择非常灵活：</p> <ul> <li>myimage:1 始终指向 1 这个分支中最新的镜像。</li> <li>myimage:1.9 始终指向 1.9.x 中最新的镜像。</li> <li>myimage:latest 始终指向所有版本中最新的镜像。</li> </ul> <p>如果想使用特定版本，可以选择 myimage:1.9.1、myimage:1.9.2 或 myimage:2.0.0。</p> <p>Docker Hub 上很多 repository 都采用这种方案，所以大家一定要熟悉。</p> <div class="col-sm-2 image pull-right"> <img class="avatar-img avata" style='border="0";border-radius: 50%' src="http://www.forbackup.tk/assets/img/author/blog.svg" alt="" height="32px" width="32px"> </div> </div> <ul class="pager"> <li><a href="/docker_col/2017/07/30/docker-learn-05.html">Docker系列 5 Dockerfile 常用指令</a></li> <li><a href="/docker_col/2017/07/30/docker-learn-07.html">Docker系列 7 Registry</a></li> </ul> </article> </div> </div> </div> <div class="footer"> <div class="container-fluid"> <div class="row-fluid"> <div class="col-sm-4 copyright"> <span>Vicky's Blog © 2018 • All right reserved.</span> </div> <div class="col-sm-4 message"> <span>Simplicity is fashionable.</span> </div> <div class="col-sm-4 madeby"> <span>Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;by&nbsp;Vicky.</span> </div> <a class="pull-right top" href="#top"><i class="fa fa-caret-up" aria-hidden="true"></i></a> </div> </div> </div> </div> <!-- Vendor - Global | Applicable to every website --> <!-- #### VENDOR OFFLINE #### --> <script src="http://www.forbackup.tk/assets/vendor-off/jquery/js/jquery.min.js"></script> <script src="http://www.forbackup.tk/assets/vendor-off/bootstrap/js/bootstrap.min.js"></script> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/svg-with-js/js/fontawesome-all.min.js"></script> <script src="http://www.forbackup.tk/assets/javascripts/jekyll-spotify-plugin.min.js"></script> <!-- Specific for each pages. --> <script type="text/javascript" src="http://www.forbackup.tk/assets/javascripts/post.js"></script> <!-- Add 'ga' function from Google Analytics to certain site links in Posts --> <!-- App | Global --> <script src="http://www.forbackup.tk/assets/javascripts/global.js"></script> </body> </html>




    



<!-- Include Data Base --> <!DOCTYPE html> <html lang="en" itemscope itemtype="http://schema.org/WebPage"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Docker系列 9 容器常用操作 | Vicky's Blog </title> <meta name=description content=""> <meta name="robots" content="index, follow"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta http-equiv="cache-control" content="public"/> <meta http-equiv="pragma" content="public"> <meta name="keywords" content="Theme, Jekyll" /> <meta name="author" content="" /> <meta property="og:locale" content="en" /> <meta property="og:site_name" content="Vicky's Blog" /> <meta property="og:type" content="WebSite" /> <meta property="og:url" content="http://www.forbackup.tk/docker_col/2017/08/05/docker-learn-09.html" /> <meta property="og:description" content="" /> <meta property="og:title" content="Docker系列 9 容器常用操作 - Vicky's Blog" /> <link rel="canonical" href="http://www.forbackup.tk/docker_col/2017/08/05/docker-learn-09.html"> <link rel="alternate" type="application/rss+xml" title="Vicky's Blog" href="http://www.forbackup.tk/feed.xml"> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "WebSite", "name": "", "headline": "Vicky's Blog", "author": {"@type": "Person", "name": {"Vicky's Blog"}}, "description": "", "url": "http://www.forbackup.tk"} </script> <script type="text/javascript"> var GLOBAL_BASEURL = "http://www.forbackup.tk"; </script> <link rel="icon" type="image/png" sizes="16x16" href="http://www.forbackup.tk/assets/img/favicon/favicon-16x16.png"> <!-- #### VENDOR OFFLINE #### --> <!-- Bootstrap 3.3.6 - Offline --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/bootstrap/css/bootstrap.min.css"> <!-- Font Awesome 5.03 - Offline --> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css"></script> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/space-mono/space-mono.min.css"> <link rel="stylesheet" href="http://www.forbackup.tk/assets/vendor-off/fonts/gloria-hallelujah/gloria-hallelujah.min.css"> <!-- Style Default --> <link rel="stylesheet" href="http://www.forbackup.tk/assets/stylesheets/main.css"> <!-- Google Analytics --> </head> <body> <div class="main" id="top"> <div class="container wrapper"> <div class="row"> <div class="col-sm-3 sidebar"> <div class="row avatar"> <a href="http://www.forbackup.tk/"> <img class="img-responsive center-block avatar-img" src="http://www.forbackup.tk/assets/img/avatar/blog.svg" height="165" width="165" alt="Vicky's Blog"> </a> </div> <div class="row header"> <h2><a href="http://www.forbackup.tk/">Vicky </a></h2> </div> <div class="row menu"> <ul> <li> <i class="fa fa-home" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/">Home</a> </li> <hr class="breakline"> <li class="li-folder-open"> <i style="font-size: ;" class="fas fa-folder-open"></i>&nbsp;<a class="unlink">Blog</a> </li> <li class="li-fa-edit"> <i style="font-size: ;" class="fas fa-edit" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/general/" >General</a> </li> <li class="li-fa-docker"> <i style="font-size: ;" class="fab fa-docker" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/docker_col/" >Docker</a> </li> <li class="li-fa-table"> <i style="font-size: ;" class="fas fa-table" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/data_analysis/" >Data Analysis</a> </li> <li class="li-fa-tags"> <i style="font-size: ;" class="fas fa-tags" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/tags/" >Tags</a> </li> <li class="li-fa-briefcase"> <i style="font-size: ;" class="fas fa-briefcase" aria-hidden="true"></i>&nbsp;<a href="http://www.forbackup.tk/blog/projects/" >Projects</a> </li> </ul> <div class="socials"> <div class="row"> <p></p> <p></p> </div> </div> </div> </div> <div class="col-sm-9 content-main"> <!-- Include Data Base --> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <!-- Next Version <div class="readmode"> <a id="btn-readmode" class="pull-right btn btn-default btn-readmode" href="">Read Mode</a> </div> --> <div class="row title"> <h1>Docker系列 9 容器常用操作</h1> </div> <div class="row meta" datetime="2017-08-05"> <time class="col-sm-6 datetime"> <i class="fa fa-calendar" aria-hidden="true"></i> <span class="text tmargin ">August 05, 2017</span> </time> </div> <div class="row tag-list"> <i class="fa fa-tags" aria-hidden="true"></i> <a href="http://www.forbackup.tk/blog/tags//linux">linux</a> <a href="http://www.forbackup.tk/blog/tags//docker">docker</a> </div> <!-- <div class="row"> <ul id="markdown-toc"> <li><a href="#stopstartrestart-容器" id="markdown-toc-stopstartrestart-容器">stop/start/restart 容器</a></li> <li><a href="#pauseunpause-容器" id="markdown-toc-pauseunpause-容器">pause/unpause 容器</a></li> <li><a href="#删除容器" id="markdown-toc-删除容器">删除容器</a></li> <li><a href="#一张图搞懂容器所有操作" id="markdown-toc-一张图搞懂容器所有操作">一张图搞懂容器所有操作</a> <ul> <li><a href="#可以先创建容器稍后再启动" id="markdown-toc-可以先创建容器稍后再启动">可以先创建容器，稍后再启动。</a></li> <li><a href="#只有当容器的启动进程-退出-时--restart-才生效" id="markdown-toc-只有当容器的启动进程-退出-时--restart-才生效">只有当容器的启动进程 退出 时，<code class="highlighter-rouge">--restart</code> 才生效。</a></li> </ul> </li> </ul> <h2 id="stopstartrestart-容器">stop/start/restart 容器</h2> <ul> <li><code class="highlighter-rouge">docker stop</code> 停止运行的容器。 <ul> <li>容器在 <code class="highlighter-rouge">docker host</code> 中实际上是一个进程，<code class="highlighter-rouge">docker stop</code> 命令本质上是向该进程发送一个 <code class="highlighter-rouge">SIGTERM</code> 信号。如果想快速停止容器，可使用 <code class="highlighter-rouge">docker kill</code> 命令，其作用是向容器进程发送 <code class="highlighter-rouge">SIGKILL</code> 信号。</li> </ul> </li> <li><code class="highlighter-rouge">docker start</code> 重新启动停止状态的容器。 <ul> <li><code class="highlighter-rouge">docker start</code> 会保留容器的第一次启动时的所有参数。</li> </ul> </li> <li><code class="highlighter-rouge">docker restart</code> 可以重启容器 <ul> <li>依次执行 <code class="highlighter-rouge">docker stop</code> 和<code class="highlighter-rouge">docker start</code>。</li> <li>容器可能会因某种错误而停止运行。对于服务类容器，我们通常希望在这种情况下容器能够自动重启。启动容器时设置 <code class="highlighter-rouge">--restart</code> 就可以达到这个效果。</li> <li><code class="highlighter-rouge">docker run -d --restart=always httpd</code> <ul> <li><code class="highlighter-rouge">--restart=always</code> 意味着无论容器因何种原因退出（包括正常退出），就立即重启。该参数的形式还可以是 <code class="highlighter-rouge">--restart=on-failure:3</code>，意思是如果启动进程退出代码非0，则重启容器，最多重启3次。</li> </ul> </li> </ul> </li> </ul> <h2 id="pauseunpause-容器">pause/unpause 容器</h2> <p>有时我们只是希望暂时让容器暂停工作一段时间，比如要对容器的文件系统打个快照，或者 dcoker host 需要使用 CPU，这时可以执行 <code class="highlighter-rouge">docker pause</code></p> <p>处于暂停状态的容器不会占用 CPU 资源，直到通过 docker unpause 恢复运行。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker pause name
docker unpause name</code></pre></figure> <h2 id="删除容器">删除容器</h2> <p>使用 docker 一段时间后，host 上可能会有大量已经退出了的容器。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker ps <span class="nt">-a</span></code></pre></figure> <p>这些容器依然会占用 host 的文件系统资源，如果确认不会再重启此类容器，可以通过 docker rm 删除。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nb">rm </span>idnum</code></pre></figure> <p><code class="highlighter-rouge">docker rm</code> 一次可以指定多个容器，如果希望批量删除所有已经退出的容器，可以执行如下命令：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nb">rm</span> <span class="nt">-v</span> <span class="k">$(</span>docker ps <span class="nt">-aq</span> <span class="nt">-f</span> <span class="nv">status</span><span class="o">=</span>exited<span class="k">)</span></code></pre></figure> <blockquote> <p>docker rm 是删除容器，而 docker rmi 是删除镜像。</p> </blockquote> <h2 id="一张图搞懂容器所有操作">一张图搞懂容器所有操作</h2> <p>下图状态机总结了容器各种状态之间是如何转换的</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_status.jpg" alt="docker状态转换 @x100" /></p> <p>如果掌握了前面的知识，要看懂这张图应该不难。不过有两点还是需要补充一下：</p> <h3 id="可以先创建容器稍后再启动">可以先创建容器，稍后再启动。</h3> <p><img src="http://www.forbackup.tk/assets/img/used/docker/create_docker.jpg" alt="create docker @x100" /></p> <ol> <li>docker create 创建的容器处于 Created 状态。</li> <li>docker start 将以后台方式启动容器。 docker run 命令实际上是 docker create 和 docker start 的组合。</li> </ol> <h3 id="只有当容器的启动进程-退出-时--restart-才生效">只有当容器的启动进程 退出 时，<code class="highlighter-rouge">--restart</code> 才生效。</h3> <p>退出包括正常退出或者非正常退出。这里举了两个例子：启动进程正常退出或发生 OOM，此时 docker 会根据 <code class="highlighter-rouge">--restart</code> 的策略判断是否需要重启容器。但如果容器是因为执行 <code class="highlighter-rouge">docker stop</code> 或<code class="highlighter-rouge">docker kill</code> 退出，则不会自动重启。</p> 1492 </div> --> <div class="row content"> <ul id="markdown-toc"> <li><a href="#stopstartrestart-容器" id="markdown-toc-stopstartrestart-容器">stop/start/restart 容器</a></li> <li><a href="#pauseunpause-容器" id="markdown-toc-pauseunpause-容器">pause/unpause 容器</a></li> <li><a href="#删除容器" id="markdown-toc-删除容器">删除容器</a></li> <li><a href="#一张图搞懂容器所有操作" id="markdown-toc-一张图搞懂容器所有操作">一张图搞懂容器所有操作</a> <ul> <li><a href="#可以先创建容器稍后再启动" id="markdown-toc-可以先创建容器稍后再启动">可以先创建容器，稍后再启动。</a></li> <li><a href="#只有当容器的启动进程-退出-时--restart-才生效" id="markdown-toc-只有当容器的启动进程-退出-时--restart-才生效">只有当容器的启动进程 退出 时，<code class="highlighter-rouge">--restart</code> 才生效。</a></li> </ul> </li> </ul> <h2 id="stopstartrestart-容器">stop/start/restart 容器</h2> <ul> <li><code class="highlighter-rouge">docker stop</code> 停止运行的容器。 <ul> <li>容器在 <code class="highlighter-rouge">docker host</code> 中实际上是一个进程，<code class="highlighter-rouge">docker stop</code> 命令本质上是向该进程发送一个 <code class="highlighter-rouge">SIGTERM</code> 信号。如果想快速停止容器，可使用 <code class="highlighter-rouge">docker kill</code> 命令，其作用是向容器进程发送 <code class="highlighter-rouge">SIGKILL</code> 信号。</li> </ul> </li> <li><code class="highlighter-rouge">docker start</code> 重新启动停止状态的容器。 <ul> <li><code class="highlighter-rouge">docker start</code> 会保留容器的第一次启动时的所有参数。</li> </ul> </li> <li><code class="highlighter-rouge">docker restart</code> 可以重启容器 <ul> <li>依次执行 <code class="highlighter-rouge">docker stop</code> 和<code class="highlighter-rouge">docker start</code>。</li> <li>容器可能会因某种错误而停止运行。对于服务类容器，我们通常希望在这种情况下容器能够自动重启。启动容器时设置 <code class="highlighter-rouge">--restart</code> 就可以达到这个效果。</li> <li><code class="highlighter-rouge">docker run -d --restart=always httpd</code> <ul> <li><code class="highlighter-rouge">--restart=always</code> 意味着无论容器因何种原因退出（包括正常退出），就立即重启。该参数的形式还可以是 <code class="highlighter-rouge">--restart=on-failure:3</code>，意思是如果启动进程退出代码非0，则重启容器，最多重启3次。</li> </ul> </li> </ul> </li> </ul> <h2 id="pauseunpause-容器">pause/unpause 容器</h2> <p>有时我们只是希望暂时让容器暂停工作一段时间，比如要对容器的文件系统打个快照，或者 dcoker host 需要使用 CPU，这时可以执行 <code class="highlighter-rouge">docker pause</code></p> <p>处于暂停状态的容器不会占用 CPU 资源，直到通过 docker unpause 恢复运行。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker pause name
docker unpause name</code></pre></figure> <h2 id="删除容器">删除容器</h2> <p>使用 docker 一段时间后，host 上可能会有大量已经退出了的容器。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker ps <span class="nt">-a</span></code></pre></figure> <p>这些容器依然会占用 host 的文件系统资源，如果确认不会再重启此类容器，可以通过 docker rm 删除。</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nb">rm </span>idnum</code></pre></figure> <p><code class="highlighter-rouge">docker rm</code> 一次可以指定多个容器，如果希望批量删除所有已经退出的容器，可以执行如下命令：</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker <span class="nb">rm</span> <span class="nt">-v</span> <span class="k">$(</span>docker ps <span class="nt">-aq</span> <span class="nt">-f</span> <span class="nv">status</span><span class="o">=</span>exited<span class="k">)</span></code></pre></figure> <blockquote> <p>docker rm 是删除容器，而 docker rmi 是删除镜像。</p> </blockquote> <h2 id="一张图搞懂容器所有操作">一张图搞懂容器所有操作</h2> <p>下图状态机总结了容器各种状态之间是如何转换的</p> <p><img src="http://www.forbackup.tk/assets/img/used/docker/docker_status.jpg" alt="docker状态转换 @x100" /></p> <p>如果掌握了前面的知识，要看懂这张图应该不难。不过有两点还是需要补充一下：</p> <h3 id="可以先创建容器稍后再启动">可以先创建容器，稍后再启动。</h3> <p><img src="http://www.forbackup.tk/assets/img/used/docker/create_docker.jpg" alt="create docker @x100" /></p> <ol> <li>docker create 创建的容器处于 Created 状态。</li> <li>docker start 将以后台方式启动容器。 docker run 命令实际上是 docker create 和 docker start 的组合。</li> </ol> <h3 id="只有当容器的启动进程-退出-时--restart-才生效">只有当容器的启动进程 退出 时，<code class="highlighter-rouge">--restart</code> 才生效。</h3> <p>退出包括正常退出或者非正常退出。这里举了两个例子：启动进程正常退出或发生 OOM，此时 docker 会根据 <code class="highlighter-rouge">--restart</code> 的策略判断是否需要重启容器。但如果容器是因为执行 <code class="highlighter-rouge">docker stop</code> 或<code class="highlighter-rouge">docker kill</code> 退出，则不会自动重启。</p> <div class="col-sm-2 image pull-right"> <img class="avatar-img avata" style='border="0";border-radius: 50%' src="http://www.forbackup.tk/assets/img/author/blog.svg" alt="" height="32px" width="32px"> </div> </div> <ul class="pager"> <li><a href="/docker_col/2017/08/05/docker-learn-08.html">Docker系列 8 如何运行容器？</a></li> <li><a href="/docker_col/2017/08/06/docker-learn-10.html">Docker系列 10 限制容器对内存的使用</a></li> </ul> </article> </div> </div> </div> <div class="footer"> <div class="container-fluid"> <div class="row-fluid"> <div class="col-sm-4 copyright"> <span>Vicky's Blog © 2018 • All right reserved.</span> </div> <div class="col-sm-4 message"> <span>Simplicity is fashionable.</span> </div> <div class="col-sm-4 madeby"> <span>Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;by&nbsp;Vicky.</span> </div> <a class="pull-right top" href="#top"><i class="fa fa-caret-up" aria-hidden="true"></i></a> </div> </div> </div> </div> <!-- Vendor - Global | Applicable to every website --> <!-- #### VENDOR OFFLINE #### --> <script src="http://www.forbackup.tk/assets/vendor-off/jquery/js/jquery.min.js"></script> <script src="http://www.forbackup.tk/assets/vendor-off/bootstrap/js/bootstrap.min.js"></script> <script defer src="http://www.forbackup.tk/assets/vendor-off/font-awesome/svg-with-js/js/fontawesome-all.min.js"></script> <script src="http://www.forbackup.tk/assets/javascripts/jekyll-spotify-plugin.min.js"></script> <!-- Specific for each pages. --> <script type="text/javascript" src="http://www.forbackup.tk/assets/javascripts/post.js"></script> <!-- Add 'ga' function from Google Analytics to certain site links in Posts --> <!-- App | Global --> <script src="http://www.forbackup.tk/assets/javascripts/global.js"></script> </body> </html>
